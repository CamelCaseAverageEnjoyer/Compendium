%% Design drawing
% Earth (Table 1)
mu = 398600.44e9;
w_earth = 7.292115e-5; % 7.29211587e-5;  % 7.2921158553e-5
Re = 6378136;  % a
J2 = -484164.954e-9;
% T_earth = 86164.090530833;

% ORB
import utils.krilov2mat
krilovangs = [-176.111, -0.893,  7.101] * pi / 180;  % from file
M_orb_brf = krilov2mat(krilovangs);  % ORF -> BRF

% RS
R_iss = [-32.062; 0.367; 0.819];
R_mlm = [-11.638; -3.223; 0];  % to be checked: 3.223 (?)
M_rs_mlm = [0 1 0;
            1 0 0;
            0 0 -1];  % RS -> MLM

% MLM
S_miedel = 13.5;
m_iss = 473726;
ball.d = {0.1, 0.05};  % real diameter
ball.r0 = {[-5.6389 - ball.d{1}/2; 0.8723 - 0.5; -0.1106];
           [-5.6389 - ball.d{2}/2; 0.8723 - 0.5; -0.1106]};  % 0.5 - length of the holder

%% Cameras
import utils.Camera

% Camera 1
load('local/cam1-lines')  % calibration lines
name = {'b1';'b2';'b3';'b4';'b5';'b6';'b7';'b8';  % calibration points
        't1';'t2';'t3';  % 't4';'t5';'t6';  % note: 3D position of t4-t6 wrong?
        'r2';'r6';'r3';'r12';
        'l2';'l4';'l8';'l7'};
pixels = [1434 1025; 870 1029; 1270 1028; 1340 895; 897 899; 1212 897; 1162 791; 1141 752;  % bottom
          874 115; 1081 116; 1286 118;   % 695 90; 730 141; 1064 138;  % t4-t6
          607 792; 669 298; 607 257; 508 205;  % right
          1408 565; 1487 582; 1754 206; 1731 883];  % left
x1 = -4.95763;
y1 = -0.9022;
x2 = -5.6389;
y2 = 0.87229;
y3 = 1.098;
x = -6.2045;
z1 = -0.74893;
pos = [(x1 - 0.985) y1 (0.43893 + 0.307);  % bottom
       (x1 - 0.985) y1 (-0.43893);
       (x1 - 0.985) y1 (-0.43893 + 0.84);
       x1 y1 ( 0.43893 + 0.307);
       x1 y1 (-0.43893);
       x1 y1 (-0.43893 + 0.846);
       -3.5629 y1 (0.46254);
       (-3.5629 + 0.928) y1 (0.46254);
       (x2 - 0.51935) y2 -0.374;  % top
       (x2 - 0.51935) y2 0;
       (x2 - 0.51935) y2 0.374;
       % (x2 - 0.51935) y3 -0.70478;
       % x2 y3 -0.70478;
       % x2 y3 0;
       (x - 0.47367) (-0.30234) z1;  % right 
       (x) (0.51646) z1;
       (x - 0.47367) (0.51646) z1;
       (x - 0.969) (0.51646) z1;
       (-6.16379 + 0.47707) 0 0.73195;  % left
       (-6.16379) 0 0.73195;
       (-6.16379 - 0.05772 - 0.47707 - 0.488) (0.52305) 0.73195;
       (-6.16379 - 0.05772 - 0.47707 - 0.488) (0.52305 - 0.824) 0.73195;
       ];

% other camera params
c1 = Camera();
c1.dt = 1/25;
c1.points = table(name, pixels, pos);
c1.eulerangs = [pi/2 pi/2 pi/2];
c1.pos = [(-8.547 - 0.399/2); 0; 0];  % 407 center
c1.lines = lines;
c1.lines_notes = ["h","v","","","h","v","v","v","h","v","","","","h"];  % line is horizontal/vertical

% Camera 2
load('local/cam2-lines')
name = {'r1';'r2';'r3';'r4';'r5';'r6';'r7';'r8';'r9';'r10';'r11';'r12'};
pixels = [260 288; 476 907; 457 462; 742 935; 744 827;  % r1-r5
          726 458; 732 240; 1039 830; 1580 243; 1555 117;  % r6-r10
          1764 276; 246 473];
x = -6.2045;
z1 = -0.74893;
z2 = -1.08654;
pos = [(x - 0.969) (0.51646 + 0.354) z1;  % right
       (x - 0.47367) (-0.30234) z1;
       (x - 0.47367) (0.51646) z1;
       (x) (-0.30234) z1;
       (x) (0.51646 + 0.354 - 0.975) z1;
       (x) (0.51646) z1;
       (x) (0.51646 + 0.354) z1;
       (x + 0.481) (0.51646 + 0.354 - 0.975) z1;
       (-4.27145) (0.627 + 0.371) z2;
       (-4.27145) (0.627 + 0.371 + 0.333) z2;
       (-3.58338) (0.627 + 0.371 + 0.333) z2;
       (x - 0.969) (0.51646) z1;
       ];
c2 = Camera();
c2.dt = 1001/24000;
c2.points = table(name, pixels, pos);
c2.eulerangs = [pi pi pi];
c2.pos = [(-6.16379 + 0.47707 - 0.08279 - 0.0071/2); (0.31143 + 0.05/2); (0.73195)];
c2.lines = lines;
c2.lines_notes = ["h","h","h","v","v","v","h","h","v","","h","v","h","h","v","",""];

% Camera 3
load('local/cam3-lines')
name = {'l1';'l2';'l3';'l4';'l5';'l6';'l7';'l8';'l9';'l10';'l11'};
pixels = [69 163; 650 832; 1067 1056; 1034 840; 1072 431;  % l1-l5
          1436 440; 1709 1003; 1754 450; 1742 195; 237 91;  % l6-l10
          640 174];
x = -6.16379;
z1 = 1.05847;
z2 = 0.73195;
pos = [(-4.94792 + 0.630) (1.098) z1;   % left
       (x + 0.47707) 0 z2;
       (x - 0.05772) (0.52305 - 0.824) z2;
       (x) 0 z2;
       (x - 0.05772) (0.52305) z2;
       (x - 0.05772 - 0.47707) (0.52305) z2;
       (x - 0.05772 - 0.47707 - 0.488) (0.52305 - 0.824) z2;
       (x - 0.05772 - 0.47707 - 0.488) (0.52305) z2;
       (x - 0.05772 - 0.47707 - 0.488) (0.52305 + 0.358) z2;
       (-4.94792) (1.098) z2;
       (x + 0.47707) (0.87229) z2;
       ];
c3 = Camera();
c3.dt = 1001/24000;
c3.points = table(name, pixels, pos);
c3.eulerangs = [pi/2 0 pi/2];
c3.pos = [(-6.14589 + 0.071/2); (0.51646 + 0.354 - 0.975 + 0.415); (-0.74893)];
c3.lines = lines;
c3.lines_notes = ["v","v","v","v","v","","h","h","h","h","h","h"];

cam = {c1, c2, c3};

%% Visualization params
d_text2point = 5;  % text-to-marker distance on plot

%% Clear unnessesary variables
clear name pixels points pos f eulerangs c1 c2 c3 x x1 x2 y1 y2 z1 z2 lines
